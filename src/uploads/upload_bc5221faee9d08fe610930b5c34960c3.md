# MAVLink简介

MAVLink是一种非常轻量级的消息传输协议, 用于地面控制终端（地面站）与无人机之间 (以及机载无人机组件之间) 进行通信。

# MAVLink消息包的结构

> MAVLink传输时，以消息包作为基本单位，数据长度为8~263字节。消息数据包的结构如下:

![img](https://img-blog.csdnimg.cn/img_convert/c5f70e2940f5ae9338012c7f9d1dbec1.png)



<img src="C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20211122173755677.png" alt="image-20211122173755677" style="zoom:150%;" />



|         | 字节索引 | 内容         | 值        | 解释                                                         |
| ------- | -------- | ------------ | --------- | ------------------------------------------------------------ |
| STX     | 0        | 包起始标志   | v1.0:0xFE | 包的起始标志，在v1.0中以"FE"作为起始标志(FE=254)             |
| LEN     | 1        | 有效载荷长度 | 0~255     | 有效载荷数据的字节长度(N)                                    |
| SEQ     | 2        | 包的序列号   | 0~255     | 每发送完一个消息，内容加1。用以检测丢包情况                  |
| SYS     | 3        | 系统ID编号   | 0~255     | 发送本条消息包的系统/飞行器的编号。用于消息接收端在同一网络中识别不同的MAV系统 |
| COMP    | 4        | 部件ID编号   | 0~255     | 发送本条消息包的部件的编号。用于消息接收端在同一系统中区分不同的组件，如IMU和飞控 |
| MSG     | 5        | 消息包ID编号 | 0~255     | 有效载荷中消息包的编号。该id定义了有效载荷内放的是什么类型的消息，以便消息接收端正确地解码消息包 |
| PAYLOAD | 6~N+6    | 有效载荷数据 | 0~255字节 | 要用的数据放在有效载荷里。内容取决于message id               |
| CKA     | N+7      | 校验和低字节 |           | 16位校验码；ITU X.25/SAE  AS-4哈希校验（CRC-16-CCITT），不包括数据包起始位，从第一个字节到有效载荷（字节1  ..(N+6)）进行crc16计算（还要额外加上一个MAVLINK_CRC_EXTRA字节），得到一个16位校验码 |
| CKB     | N+8      | 检验和高字节 |           |                                                              |





注：校验（checksum）功能。加入**MAVLINK_CRC_EXTRA**，当两个通讯终端之间（飞行器和地面站，或飞行器和飞行器）**使用不同版本的MAVLink协议时，双方计算得到的校验码会不同，则不同版本的MAVLink协议之间将无法通讯**。MAVLINK_MESSAGE_CRCS中存储了每种消息包对应的MAVLINK_CRC_EXTRA。这个 MAVLINK_CRC_EXTRA在用python生成MAVLink代码时在common.h头文件中自动生成。

```js
typedef struct __mavlink_message {  
uint16_t checksum; /// CRC
uint8_t magic;   /// STX
uint8_t len;     /// LEN
uint8_t seq;     /// SEQ
uint8_t sysid;   /// SYS
uint8_t compid;  /// COMP
uint8_t msgid;   /// MSG
uint64_t payload64[(MAVLINK_MAX_PAYLOAD_LEN+MAVLINK_NUM_CHECKSUM_BYTES+7)/8];  
10 } mavlink_message_t;  
```





# 接口

> http://192.168.101.142:8081/select?longitude=113.29097&latitude=31.883232

## 参数

```js
weatherData: {
  humidity: "0.13", // 湿度
  temperature: "10", // 温度
  skycon: "CLOUDY",  // 天气
  pressure: "101244.09", // 压强
  direction: "3",  // 风向
  speed: "28.8"  // 风速
}
```



